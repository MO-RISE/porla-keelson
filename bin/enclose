#!/usr/bin/env python3

"""
Command line utility tool for processing input from stdin. Each line on the
input stream is expected to be base64-encoded and will be enclosed into a
brefv.Envelope. The enclosed envelope will be serialized and base64-encoded
and then outputted to stdout.
"""

import sys
from base64 import b64encode, b64decode

from brefv import enclose

for line in sys.stdin:
    payload = b64decode(line.encode())
    message = enclose(payload)
    sys.stdout.write(f"{b64encode(message).decode()}\n")
    sys.stdout.flush()
